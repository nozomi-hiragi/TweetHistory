# Settings 画面仕様

## 概要
アプリの各種設定を管理する画面の仕様です。テーマ設定、言語切り替え、データ管理、ユーザー設定など、包括的な設定機能を提供します。

## 実装済み機能

### 1. テーマ設定
- **ダークモード切り替え**：ライト・ダークモード・システム設定の3オプション
- **実装**：`ThemeModeController`による状態管理
- **永続化**：`PreferencesRepository`にて保存
- **UI**：スイッチまたはラジオボタンによる選択

### 2. 言語設定
- **対応言語**：
  - 日本語（ja-JP）
  - 英語（en-US）
  - システム設定（端末の言語設定に従う）
- **実装**：`LocaleController`による動的言語切り替え
- **UI**：モーダルダイアログでのラジオボタン選択
- **即座反映**：選択と同時にUI言語が変更

### 3. ユーザーID設定
- **機能**：Twitter/Xのユーザー名設定（@マークなし）
- **用途**：ツイート詳細ダイアログでのURL生成に使用
- **実装**：`UserIdController`による管理
- **UI**：専用ダイアログ（`UserIdInputDialog`）
- **バリデーション**：適切なユーザー名形式のチェック

### 4. データ管理（インポート/エクスポート）
- **エクスポート機能**：
  - 全ツイートデータ、タグ、設定をJSON形式で出力
  - ファイルダウンロード機能（Web対応）
  - IndexedDBとPreferencesの完全バックアップ
- **インポート機能**：
  - JSONファイルからの全データ復元
  - ファイルピッカー（`file_picker`使用）
  - エラーハンドリングとユーザーフィードバック
- **実装**：`DataTransferController`による制御
- **UI**：専用ダイアログ（`ImportExportDialog`）

### 5. アプリ情報
- **バージョン表示**：`package_info_plus`から取得
- **ライセンス表示**：Flutterの標準ライセンスページ
- **実装**：設定画面内のリストタイル

## UI構成

### 設定画面レイアウト
```
┌─────────────────────────────────┐
│ Settings / 設定                 │
├─────────────────────────────────┤
│ 🌙 ダークモード        [Switch] │
│ 🌐 言語設定           日本語 >   │
│ 👤 ユーザーID設定     @user >    │
│ 📤 データ管理    Import/Export > │
│ ℹ️  バージョン情報    v0.2.0    │
│ 📄 ライセンス                >  │
└─────────────────────────────────┘
```

## データ構造

### エクスポートデータ形式
```json
{
  "indexedDB": {
    "tweet_db": {
      "tweets": [...],
      "tags": [...],
      "deleted": [...]
    }
  },
  "preferences": {
    "themeMode": 0,
    "locale": "ja-JP",
    "userId": "username"
  }
}
```

### 設定の永続化
- **保存先**：`SharedPreferences`（Webではローカルストレージ）
- **管理対象**：
  - テーマモード（0: システム, 1: ライト, 2: ダーク）
  - 言語設定（locale code）
  - ユーザーID（Twitter username）
  - その他の隠れた設定（フィルタ状態など）

## プロバイダー・状態管理

### 関連プロバイダー
- **`ThemeModeController`**：テーマ状態管理
- **`LocaleController`**：言語状態管理  
- **`UserIdController`**：ユーザーID管理
- **`DataTransferController`**：データ入出力制御

### 永続化レイヤー
- **`PreferencesRepository`**：設定値の読み書き
- **設定値の自動保存**：状態変更時に即座に永続化

## ダイアログ・UI コンポーネント

### ImportExportDialog
- **エクスポート**：JSONダウンロード機能
- **インポート**：ファイル選択とデータ復元
- **プログレス表示**：処理中のローディング
- **結果フィードバック**：SnackBarによる成功・エラー通知

### UserIdInputDialog
- **入力フィールド**：ユーザー名入力（@なし）
- **バリデーション**：リアルタイム入力チェック
- **ヘルプテキスト**：使用目的の説明
- **プレビュー**：設定後のURL例示

### LanguageSelectionDialog
- **ラジオボタン**：3つの言語オプション
- **即座反映**：選択と同時に言語変更
- **現在選択中の表示**：視覚的フィードバック

## 国際化対応

### サポート言語
- **日本語（ja）**：メイン言語、完全対応
- **英語（en）**：フルサポート
- **システム設定**：端末言語の自動検出

### 言語切り替え
- **動的切り替え**：アプリ再起動不要
- **永続化**：選択言語の保存
- **フォールバック**：未対応言語時の英語表示

## エラーハンドリング

### データインポート時
- **ファイル形式エラー**：不正なJSONファイル
- **データ整合性エラー**：破損したデータ構造
- **ユーザーフィードバック**：具体的なエラーメッセージ

### 設定保存時
- **永続化失敗**：ストレージアクセスエラー
- **自動リトライ**：一時的な失敗の再試行

## 将来拡張予定

### 追加設定項目
- **テーマカラー変更**：Material Designカラーパレット
- **フォントサイズ設定**：アクセシビリティ対応
- **自動バックアップ設定**：定期エクスポート機能
- **キャッシュクリア**：ストレージ管理機能

### 高度なデータ管理
- **選択的エクスポート**：タグやツイートの部分的バックアップ
- **クラウド同期**：Google Drive等との連携（予定なし）
- **データ圧縮**：大容量データの効率的な保存

## 関連ファイル
- **実装**：`lib/features/settings/settings_screen.dart`
- **ダイアログ**：`lib/features/settings/import_export_dialog.dart`
- **プロバイダー**：`lib/providers/theme_mode_controller.dart`等
- **永続化**：`lib/repository/preferences_repository.dart`